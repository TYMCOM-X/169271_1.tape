:C: DUAL SELECTOR DIM
                               DUAL HOST DIM ROUTINES
                               ----------------------
       DESCRIPTION OF THE DUAL SELECTOR CHANNEL DIM VERSION 11

PLEASE SEND CRITICISM OF THIS DOCUMENT TO DAVID GARDNER OR TO
DAVE ON C2. DIM LISTINGS ARE NOT PROPRIETARY. ANYBODY CAN MAKE A LISTING.
SEND MAIL TO DAVE ON C2 TO FIND OUT HOW TO LIST IT.

A KNOWLEDGE OF THE SINGLE HOST DISC MONITOR (DIM) IS ASSUMED.
DIM FACTS FOLLOW.

PRACTICALLY ALL THE DIM CODE IS NEW.

DIM NOW CONTROLS 2 HOSTS FROM UP TO 16 LOGICAL 2314 DISC PACKS, WHERE
ONE 940 CAN ADDRESS PACKS 0-7 AND THE OTHER HOST CAN ADDRESS PACKS
8-15 (8-F THE CALCOMP ADDRESSING PLUGS ARE IN HEXADECIMAL)

THE NEW DIM CAN PERFORM UP TO 8 CONCURRENT SEEKS. THIS WILL ALLEVIATE
THE PROBLEM OF SHARING THE DISC RESOURCES BETWEEN TWO HOSTS AND WILL
OCCASIONALLY HELP A SINGLE HOST TO ACHEIVE FASTER RESPONSE ON SOME
BURSTS OF DISC REQUESTS.  UNFORTUNATELY THE CURRENT SWAPPING BOTTLE NECK
AND THE SCHEDULING ALGORIRITHMS CONSISTENT WITH THE TINY 940 MEMORY,
PREVENTS THE 940 FROM MAKING A LOT OF CONCURRENT DISC REQUESTS ON 
DIFFERENT PACKS.


THE CHANNEL CAN ONLY SERVE ONE HOST AT A TIME SO SOMETIMES ONE HOST MAY
HAVE TO WAIT A SHORT TIME TO GET THE CHANNEL. THE CHANNEL IS DEDICATED
TO ONE 940 DURING A TRANSFER AND THE ROTATIONAL LATENCY TIME THAT
PRECEDES ALL TRANSFERS. DIM DOES NOT TRY TO OPTIMIZE LATENCLY DELAYS.
INTERFERENCE OF THIS SORT WILL CAUSE A VERY LOW AVERAGE DELAY SINCE THE
CHANNEL IS TIED UP ONLY A VERY SMALL PERCENTAGE OF THE TIME.

THE NEW DIM WILL PROBABLY HAVE AN OVERALL SLIGHTLY FASTER RESPONSE TIME.

DIM WILL SAVE CRASHES IN THE OLD WAY EXCEPT THAT IT WILL ALSO PUT SOME
CRASH INFORMATION ON DISC 24 FROM MEMORY LOCATIONS 140000 TO 177777.
DIM WILL NEVER AUTOMATICALLY RELOAD ITSELF.
THE OPERATOR WILL BE ABLE TO RELOAD THE DIM MEMORY
BY BRANCHING TO THE 17600 IPL. DIM RELOADS ARE RECOMMENDED AFTER ALL
DIM CRASHES SINCE THE CRASH MAY HAVE BEEN CAUSED BY DESTROYED 
INFORMATION IN A VITAL PART OF MEMORY. DIM IS CODED TO RESTART FROM
LOCATION 0 OF MEMORY. THIS IS A HANDY BUT DANGEROUS FEATURE TO BE USED
WITH DISCRETION.


IF SENSE SWITCH 1 IS ON WHEN THE OPERATOR BRANCHES TO THE 17600 IPL LOADER,
AN ALTERNATE COPY OF DIM WILL BE LOADED INTO THE 620 MEMORY.
SENSE SWITCH 2 HAS NO USE.
SENSE SWITCH 3 WILL CRASH A RUNNING DIM.

DIM DDT HAS AN IMPROVED COMMAND SET, A COMPRESSED SYMBOL TABLE, AND A
LESS ANNOYING STATUS SCHEME. SEE BELOW FOR THE DDT COMMAND SET AND THE
DESCRIPTION OF DIAGNOSTIC AND UTILITY PROGRAMS THAT MAY BE CALLED FROM
DIM.

ALTHOUGH DIM IS SHORT ON MEMORY SPACE, ALL THE DIM FEATURES FIT IN ONE
8K VERSION WITH NO ASSEMBLY SWITCHES.

P=77 AFTER A DIM CRASH. A AND LOCATION 77 CONTAIN THE MARK LOCATION OF
CRASHV. CRASHV IS THE VARIAN CRASH SUBROUTINE. CRASHH IS THE HOST CRASH
SUBROUTINE WHICH IS NOT FATAL TO THE 620. LOCATION 100 CONTAINS A
POINTER TO THE BEGINNING OF THE CRASHV CODE.


*              *****************************************************

A DIM DDT REFERENCE FOLLOWS.

CONTROL S TERMINATES AND ABORTS DDT TTY INPUT AND OUTPUT.
CONTROL S ALSO TERMINATES MOST OF THE LONG RUNNING OPERATOR CODES.


;[ OR ;$ OR ;] OR ;" WILL SET THE STANDARD DDT TYPE OUT MODE TO BE
OCTAL, SIGNED INTEGER, SYMBOLIC, OR ASC.

LET EXP BE ANY VALID DDT EXPRESSION.
EXP[ AND EXP$ AND EXP] AND EXP" TYPE OUT THE CONTENTS OF THE CELL
AT LOCATION EXP AND OPEN THAT CELL.

[ AND $ AND ] AND " WITH NO ARGUMENT EXPRESSION TYPE OUT THE CELL
POINTED TO BY THE LAST EXPRESSION THAT DDT TYPED.


= AND # AND _ AND ' THE TRANSLATE AND TYPE OUT THE LAST STRING
TYPED BY THE USER OR DDT. THE OUTPUT IS OCTAL, SIGNED INTEGER, SYMBOLIC,
OR ASC.

/ ACTS LIKE [ OR $ OR ] OR " DEPENDING ON THE CURRENT TYPE OUT MODE
WHICH IS INITIALLY SYMBOLIC AND CAN BE CHANGED BY THE ;[ OR ;$ OR ;]
OR ;" COMMANDS.

CONTROL B FOLLOWED BY A STRING IS THE BIT LOOKER COMMAND.

LINE FEED OPENS AND TYPES OUT THE CELL AFTER THE LAST CELL THAT WAS
OPENED.

UP ARROW OPENS AND TYPES THE CELL PREVIOUS TO THE LAST CELL THAT WAS
OPENED.

CARRIAGE RETURN CLOSES A CELL.

CARRIAGE RETURN, LINE FEED, OR UP ARROW ALL CHANGE  A CELL IF THEY
ARE PRECEDED BY AN EXPRESSION. IF THE EXPRESSION IS INVALID, DDT TYPES
A QUESTION MARK AND IT IS OK TO TRY AGAIN WITH A NEW EXPRESSION OR TO
FORGET THE EXPRESSION AND JUST CLOSE THE OPEN CELL.

THE AT SIGN COMMAND IS DISCONTINUED. OPERATOR COMMANDS ARE EXECUTED VIA
THE ;G COMMAND.

EXP;A, EXP;B, EXP;X PRESET THE A,B, AND X VALUES FOR THE NEXT ;G
COMMAND.

EXP;G JUMPS TO THE LOCTION EXP WITH THE CURRENT VALUES OF ;A, ;B, AND ;X
IN A,B,X. THE FIRST INTRUCTION AT LOCATION EXP MUST BE A COPY AX OR DDT
WILL NOT ALLOW THE ;G TO TAKE CONTROL UNLESS THE USER HAS SET STATUS.
THE CODE REACHED BY THE ;G COMMAND MAY RETURN TO DDT BY EXECUTING A JMP L
INTRUCTION WHICH WILL SET ;A, ;B, AND ;X TO NEW VALUES OF A,B,X. OR A
JMP RST INTRUCTION WILL RETURN TO DDT WITHOUT CHANGEING 
;A, ;B, AND ;X. IT IS LEGAL TO USE THE ;G COMMAND WITH TWO ARGUMENT
EXPRESSIONS AS IN 6,FORMAT;G WHICH CALLS THE FORMAT CODE WITH
THE ARGUMENT 6.
       NOTE TO DIM CODERS AND PATCHERS. IF THE ;G ROUTINE IS LONG
AND OF LOW PRIORITY IT SHOULD FREQUENTLY CALL THE MAYDMS ROUTINE BY
EXECUTING      ... JMPM; H; +MAYDMS ... 
               .... IN ORDER TO GET TEMPORARILY DISMISSED WHILE
IMPORTANT DIM FUNCTIONS CATCH UP WITH REAL TIME DEMANDS. MAYDMS WILL
RETURN TO THE USER AFTER 50 CYCLES OF EXECUTION TIME IF NO REAL TIME
SYSTEM DEMANDS ARE PENDING. IF THERE ARE SOME REAL TIME JOBS TO BE
PROCESSED, MAYDMS WILL GIVE CONTROL TO DIM TO LET DIM CATCH UP. AFTER A
FEW HUNDRED MICROSECONDS DIM WILL RETURN TO MAYDMS WHICH WILL
RETURN TO THE CALLER AS IF NOTHING HAD HAPPENED.
       MAYDMS PRESERVES B AND X BUT DESTROYS A.
       MAYDMS ALSO CHECKS TO SEE IF THE USER TYPED A CONTROL S. IF THE
USER HAS TYPED A CONTROL S, MAYDMS TAKES CONTROL AWAY FROM THE USER
PROGRAM AND RETURNS CONTROL TO DDT.
       DIM MAY BE TIMESHAREING WHILE THE USER CODE IS RUNNING. IF DIM
IS TIMESHAREING, IT IS VERY IMPORTANT TO CALL MAYDMS
AT LEAST EVERY FEW MILISECONDS OR THE SERVICE TO THE 940S WILL BE LESS
THAN FULL SPEED. IF NO 940S ARE UP IT IS GOOD PRACTICE
TO CALL MAYDMS SO THAT CERTAIN TIMEOUT ROUTINES GET TO RUN. IF MAYDMS
IS NOT CALLED, IT WILL NOT HURT DIM ALTHOUGH DIM WILL NOT
RUN OPTIMALLY.

EXP;1, EXP;2, EXP;M, AND EXP;L SET THE WORD SEARCH PARAMETERS.

;Z ALWAYS CHANGES MEMORY BETWEEN ;1 AND ;2 INCLUSIVE. ;Z CHANGES CELLS
TO 0. EXP;Z CHANGES CELLS TO EXP. EXP1,EXP2 SUBSTITUTES EXP1 FOR EVERY 
OCCURANCE OF EXP2 IN THE ;Z RANGE.

;W AND ;# ARE WORD SEARCH COMMANDS. THEY REFER TO ;1, ;2, AND ;M.

EXP;/ TYPES OUT A 940 CELL FROM THE 940 SELECTED BY M540.
0,EXP;/ OR 1,EXP;/ SET M540 TO 0 (LOWER PACKS 940) OR 1 (UPPER PACKS
940) AND AND THEN ACT LIKE EXP;/ .
THE CURRENT 940 TYPE OUT CELL IS M540 WHICH CAN BE SET WITH THE TWO
ARGUMENTS ;/ COMMAND OR ANY OTHER CONVENIENT WAY.

SEMILINEFEED  TYPES OUT THE NEXT 940 CELL.

EXP1,EXP2 SEMILINEFEED TYPES OUT A RANGE OF 940 CELLS FROM THE CURRENTLY
SELECTED 940 WHICH IS DETERMINED BY THE CONTENTS OF M540.

EXP1,EXP2%/ ASKS FOR AN OCTAL VALUE AND SETS A RANGE OF 940 CELLS TO
THAT VALUE. IF THE RANGE IS 0 TO 177777 THE COMMAND TAKES 45 SECONDS
TO COMPLETE. THE COMMAND CAN BE ESCAPED WITH A CONTROL S. WHEN THE COMMAND
COMPLETES NORMALLY IT TYPES A CARRIAGE RETURN. THIS COMMAND READS
BACK EVERYTHING IT TRIES TO STORE IN THE 940 AND EXITS WITH A QUESTION
MARK IF IT EVER GETS A BAD READ BACK.

EXP%/ WORKS LIKE EXP1,EXP2%/ EXCEPT IT ONLY CHANGES ONE 940 CELL.

EXP1,EXP2%W ASKS FOR AN OCTAL VALUE AND THEN SEARCHES A RANGE OF 940
CELLS FOR THAT VALUE AND TYPES OUT WHERE THE VALUE WAS FOUND.


OPERATOR COMMANDS FOR UTILITY AND DIAGNOSTIC  PURPOSES ARE DESCRIBED
BELOW.

OPERATOR COMMANDS ARE REACHED VIA THE ;G COMMAND. THE AT SIGN COMMAND IS
DISCONTINUED.

VERS;G  TYPES THE DIM VERSION NUMBER. THE VERSION IS ALSO TYPED WHEN
THE DIM IS STARTED OR RESTARTED. THE OCTAL VERSION NUMBER IS LOCATED
IN THE CELL JUST BEFORE VERS. THE VERSION NUMBER MAY BE PATCHED VIA
THE VERS-1[ COMMAND.

0,STAT;G AND 1,STAT;G RESET OR SET STATUS. DDT ASKS FOR A PASSWORD TO
SET STATUS. STATUS IS REQUIRED FOR DANGEROUS COMMANDS AND DDT
TELLS THE USER WHEN STATUS IS LACKING. ONCE SET, STATUS REMAINS SET
UNTIL A 0,STAT;G COMMAND OR A PERIOD OF ABOUT 10 MINUTES OF NO DDT
COMMANDS ELAPSES.

WP;G  WRITE PROTECTS THE DISC FROM ALL NORMAL DIM WRITES. DIM ONLY
SLIGHTLY MODIFIES THE CHANNEL PROGRAMS SO A WP COMMAND LETS THE CHANNEL
EXERCISE IN A MODE VERY SIMILAR TO THE WRITE ENABLED MODE. THERE ARE A
FEW SPECIAL ROUTINES THAT ARE ALWAYS WRITE ENABLED. THESE EXCEPTIONS
ARE NEVER CALLED AUTOMATICALLY AND THESE EXCEPTIONS ARE INDIVIDUALLY
DETAILED BELOW.

WE;G WRITE ENABLES THE DISC. DIM COMES UP WRITE ENABLED.

UP;G  ASKS THE OPERATOR FOR THE HOST NUMBER AND THE MONITOR LOC.
UP SAVES THE CRASH ON LOC. 0,1,20 AND 24 AND LOADS THE MONITOR
INTO THE 940 MEMORY. WITHOUT STATUS THE LOC. MUST BE LESS
THAN 17. IF THE HOST SPECIFIED IS ON NEITHER THE LOWER OR UPPER
PACKS, DIM TYPES BAD HOST NUMBER. IF EITHER PACK 0 OR PACK 8 IS OFF LINE
AND THE HOST NUMBER IS INVALID, DIM TYPES IO ER. IF AN IO ERROR OCCURS
IN LOADING THE MONITOR, DIM TYPES IO ER. IF THE OPERATOR DOES NOT KNOW
WHAT HOSTS ARE ON HIS PACKS, HE MUST BRING UP A KNOWN HOST AND READ
THE HOST NUMBER OFF THE UNKNOWN PACKS. THE UP COMMAND MAY ALSO
TYPE "ER,ALREADY UP" OR "MIC ER".  UP ONLY CHECKS FOR DISC READ ERRORS.
DISC WRITE ERRORS DO NOT ABORT THE UP COMMAND. IF IO ER KEEPS A 940 FROM
COMING UP, THAT HOST IS DOWN UNTIL AN EXPERT DIAGNOSES THE PROBLEM.
UP-1;G WORKS LIKE UP;G EXCEPT THAT IT INHIBITS THE CRASHSAVE.

TDI;G TYPES DIAGNOSTIC INFORMATION. TDI TYPES OUT LOCATION 14, 44-51,
THE LAST CHANNEL PROGRAM EXECUTED AND THE CHANNEL PROGRAM DATA. TDI
ALSO DOES A SENSE AND TYPES OUT 6 SENSE BYTES IF ADVISEABLE. THERE ARE
SOME CHANNEL PROGRAMS THAT TDI CANNOT TYPE OUT, BUT TDI HANDLES MOST OF
THEM. THE TDI TYPE OUT CAN BE ABORTED BY TYPING A CONTROL S.

EXP,PC;G COPIES PACK A STARTING AT CYLINDER B AND HEAD X TO PACK EXP.
IT IS ALWAYS NECESSARY TO CHECK ;A, ;B, AND ;X BEFORE CALLING PC.  THE
USER MAY ABORT PC BY TYPING CONTROL S ON THE DIM TTY. WHEN PC ABORTS
IT LEAVES ;A, ;B, AND ;X AT A GOOD PLACE TO RESTART PC. PC WILL COPY
2 LOGICAL PACKS IF ;A AND EXP ARE EVEN. PC TYPES OK WHEN IT IS DONE.

EXP,RB;G READS A 600 WORD BLOCK FROM PACK EXP, CYLINDER A, HEAD B, AND
RECORD X INTO THE 620 BUFFER CALLED DBF. UNLIKE MOST OPERATOR COMMANDS
RB WILL NOT RUN UNLESS THE USER HAS SET STATUS.

EXP,RT;G READS A TEST PACK THAT HAS BEEN INITIALIZED BY WT (SEE BELOW).
RT EXERCISES THE SELECTOR CHANNEL AND PACK EXP. RT IGNORES ;B
AND ;X, BUT ;A MUST BE PRESET. IF ;A IS ODD, RT DOES SOME OF ITS READS
INTO, 940 MEMORY. IF ;A IS EVEN RT READS ONLY INTO THE 620. IF ;A/2 IS
EVEN RT TYPES OUT DETAILED DIAGNOSTIC INFORMATION ABOUT  THE CHANNEL
PROGRAM THAT CAUSED AN ERROR. IF ;A/2 IS ODD, RT TYPE OUT ABREVIATED
DIAGNOSTIC INFORMATION. IF ;A/4 IS EVEN, RT CONTINUES TO RUN
INDEFINITELY.  IF ;A/4 IS ODD, RT RETURNS TO DDT AFTER THE FIRST ERROR
TYPE OUT.  THE USER CAN ALWAYS ABORT RT BY TYPING CONTROL S ON THE DIM
TTY.  RT CHECKS FOR SEEK ERRORS, SKIP FAILURES, DATA ERRORS, AND MIC
ERRORS IF THE 940 IS INCLUDED IN THE DIAGNOSES. ALL READ AND SKIP DATA
IS AIMED AT A CELL IMMEDIATELY FOLLOWING THE 620 DISC INPUT BUFFER. IF
THIS CELL IS DISTURBED, RT TYPES SKIP FAULT. THIS CELL COULD BE
BY THE CHANNEL STORING ONE BEYOND THE END OF THE 620 DATA READ BUFFER.
SO SKIP FAULT ALSO TYPES WHEN THIS TYPE OF ERROR OCCURS. THE LAST WORD
OF THE 620 DISC BUFFER IS DBF+577. DBF+600 SHOULD CONTAIN 123456.

EXP,WT;G WRITES A TEST PACK TO BE LATER READ BY RT. IF EXP IS EVEN, WT 
INITIALIZES 2 LOGICAL PACKS OR 1 PHYSICAL CALCOMP PACK. WT EXITS WHEN
THE USER TYPES CONTROL S ON THE DIM TTY, OR ON AN IO ERROR WITH THE
MESSAGE IO ER, OR  WHEN IT IS DONE WORKING WITH THE MESSAGE OK. IT TAKES
WT 400 SECONDS TO RUN TO COMPLETION. WT WRITES EVEN IF WP;G HAS EXECUTED.

EXP,FORMAT;G FORMATS A CALCOMP PHYSICAL PACK IF EXP IS EVEN, OR ONE
LOGICAL 2314 PACK IF EXP IS ODD. FORMAT EXITS WHEN THE USER TYPES
CONTROL S ON THE DIM TTY, OR WHEN IT ENCOUNTERS AN IO ERROR WITH THE
MESSAGE IO ER, OR WHEN IT IS DONE WORKING WITH THE MESSAGE OK. IT TAKES
FORMAT 400 SECONDS TO RUN TO COMPLETION.

ERRORS;G TYPES THE ACCUMULATED I-O ERROR COUNT AND LISTS AS MUCH 
DIAGNOSTIC INFORMATION AS HAS BEEN STORED IN A 200 WORD TABLE. EACH BAD 
I-O OPERATION IS DESCRIBED BY A TYPE OUT THAT INCLUDES CYLINDER AND HEAD
NUMBER AND THE LETTER R OR W FOR READ OR WRITE FOLLOWED BY EITHER
A CHANNEL STATUS WORD OR 6 SENSE BYTES.

RSTE;G RESETS THE ERROR COUNTER AND THE ACCUMULATED LIST OF DIAGNOSTIC
INFORMATION.

EXP,SNGN;G WILL SET THE VALUE OF THE CELL CALLED NGN (NOT GOOD N940) TO
EXP. EXP SHOULD BE -1 TO ALLOW DIM TO ACCESS BOTH 940S, 0 IF MIC 
REQUESTS CANNOT REACH 940  0, AND 1 IF MIC REQUESTS CANNOT REACH
940 1. THIS COMMAND IS USEFUL TO ENGINEERS WHEN THEY DISCONNECT
ONE OF THE 940S THAT DIM HAD DECIDED WAS A LEGAL MACHINE AND WHEN
THEY RECONNECT THAT 940.

MICT;G  DRIVES THE MIC ON A SPECIFIED 940 ASSUMING THAT THE SPECIFIED
940 IS NOT TIMESHARING. ;B AND ;X MUST BE PRESET TO TELL MICT THE
INCLUSIVE RANGE OF ADDRESSES IN THE 940 TO WRITE AND READ FROM. ;A MUST
BE PRESET IN BITS 11-15 (COUNTING LEFT TO RIGHT). THE RIGHTMOST BIT IS
ON FOR THE 940 ASSOCIATED WITH THE UPPER PACK NUMBERS AND OFF FOR THE
OTHER 940. BIT 14 (2) IS ON TO TEST THE MIC WITH ONE BITS ON. BIT 13 (4)
IS ON FOR A ZERO TEST. BIT 12 (10) IS ON FOR A 25252525 TEST. AND,
BIT 11 (20) IS ON FOR AN ADDRESSING TEST. IF THE MIC IS NOT READY WHEN
IT SHOULD BE, MICT TYPES "MIC UNREADY".  BAD DATA IS DESCRIBED BY A 
3 WORD TYPEOUT OF THE 940 ADDRESS AND WHAT THE DATA SHOULD BE FOLLOWED
BY THE BAD DATA.  THE ONLY NORMAL WAY TO STOP MICT IS TO TYPE A CONTROL
S.  16;A  0;B  17777;X MICT;G TESTS 16K OF THE LOWER PACKS 940 WITH
THREE DATA TEST PATTERNS, MINUS ONE, ZERO, AND 25252525.

CONTROL B FOLLOWED BY A STRING OF CHARACTERS THAT IDENTIFY A SET OF 
SELECTOR CHANNEL BITS FOLLOWED BY A BLANK OR ANY NON ALPHANUMERIC
CHARACTER TYPES OUT A BINARY STRING OF BITS TO THE USER.
THE BIT LOOKER SYMBOL TABLE MAY BE CHANGED TO ACCOMODATE NEW BIT
LOOKERS.  SEE THE COMMENT IN THE DIM SYMBOLICS AT :BLST:.

5-23-73
   